#!/bin/bash

apt install gawk libtool python3-dev python3 pkg-config
mkdir -p output
for OPT in O0 O3; do
  echo Building for $ARCH-$OPT
  make clean
  CFLAGS="-g -${OPT}"
  CFLAGS=$CFLAGS CXXFLAGS=$CFLAGS ./configure  --prefix=$(pwd)/output
  make -j16
  make install
  ls output/bin/ | while read -r BIN_NAME;do
    file output/bin/$BIN_NAME | grep -q ELF && FLAG=1
    if [ ! -z $FLAG ];then
      cp output/bin/$BIN_NAME /home/root/share/libxml2/$XML_VERSION/$BIN_NAME-$ARCH-gcc-$OPT
    fi
  done

  find  output/lib/ -type f -printf '%f\n' | grep '.*\.so' | while read -r BIN_NAME;do
    cp output/lib/$BIN_NAME /home/root/share/libxml2/$XML_VERSION/$BIN_NAME-$ARCH-gcc-$OPT
  done

  make clean
  rm -rf output/*
done



